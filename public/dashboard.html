<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<link rel="icon" href="https://i.postimg.cc/D0ywRzWK/Volt.jpg" type="image/png">
<style>
body { font-family: Tahoma, Arial; background:#eef2f7; direction:rtl; }
.container { max-width:1200px; margin:40px auto; background:#fff; padding:30px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.1); }
h2 { text-align:center; margin-bottom:20px; color:#333; }
table { width:100%; border-collapse:collapse; margin-top:20px; }
th, td { border:1px solid #ddd; padding:10px; text-align:center; vertical-align: middle; }
th { background:#f8f9fa; }
button { padding:6px 12px; border:none; border-radius:6px; cursor:pointer; color:#fff; }
.accept { background:#28a745; }
.reject { background:#dc3545; }
button:hover { opacity:0.85; }
.status { font-weight:bold; }
.Ù…Ù‚Ø¨ÙˆÙ„ { color:green; }
.Ù…Ø±ÙÙˆØ¶ { color:red; }
.Ù‚ÙŠØ¯\\ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© { color:orange; }
.logout { float:left; background:#007bff; color:#fff; padding:8px 14px; border-radius:6px; margin-bottom:15px; cursor:pointer; }
.logout:hover { opacity:0.85; }
img { max-width: 80px; max-height: 80px; border-radius: 8px; }
.logo-img { max-width:120px; max-height:60px; display:block; margin:0 auto 20px auto; }
</style>
</head>
<body>
<div class="container">
<img src="https://i.postimg.cc/D0ywRzWK/Volt.jpg" alt="Logo" class="logo-img">
<button class="logout" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<h2>ğŸ“Š Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ1</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ2</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹</th>
<th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
<th>Ø§Ù„Ø£Ù„ÙˆØ§Ù†</th>
<th>Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†</th>
<th>Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†</th>
<th>Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
<th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
<th>Ù…Ù„Ø­ÙˆØ¸Ø©</th>
<th>Ø§Ù„ØµÙˆØ±Ø©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody id="ordersTable"></tbody>
</table>

<h2>ğŸšš ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©</h2>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ1</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ2</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹</th>
<th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
<th>Ø§Ù„Ø£Ù„ÙˆØ§Ù†</th>
<th>Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>Ø¥Ø¬Ø±Ø§Ø¡</th>
</tr>
</thead>
<tbody id="shipmentTable"></tbody>
</table>
</div>

<script>
const token = localStorage.getItem("token"); 
const role = localStorage.getItem("role");

function logout(){ localStorage.clear(); window.location = "login.html"; }

async function checkAuth(){
  if(!token || role!=="admin"){ return window.location="login.html"; }
  await loadOrders();
  await loadShipmentOrders();
}

async function loadOrders(){
  const res = await fetch("/api/orders",{ headers:{"Authorization":"Bearer "+token} });
  const orders = await res.json();
  renderOrders(orders);
}

function renderOrders(orders){
  const table = document.getElementById("ordersTable");
  table.innerHTML = "";
  orders.forEach(o=>{
    const imgHTML = o.imageUrl ? `<img src="${o.imageUrl}">` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${o.fullName||""}</td>
      <td>${o.phone1||""}</td>
      <td>${o.phone2||""}</td>
      <td>${o.address||""}</td>
      <td>${o.pieces||""}</td>
      <td>${o.size||""}</td>
      <td>${o.colors||""}</td>
      <td>${o.priceNoShip||""}</td>
      <td>${o.shipping||""}</td>
      <td>${o.priceTotal||""}</td>
      <td>${o.commission||""}</td>
      <td>${o.note||""}</td>
      <td>${imgHTML}</td>
      <td class="status ${o.status}">${o.status}</td>
      <td>
        <button class="accept" onclick="updateStatus('${o.id}','Ù…Ù‚Ø¨ÙˆÙ„')">âœ”ï¸</button>
        <button class="reject" onclick="updateStatus('${o.id}','Ù…Ø±ÙÙˆØ¶')">âŒ</button>
      </td>
    `;
    table.appendChild(tr);
  });
}

async function updateStatus(id,status){
  const res = await fetch("/api/orders/"+id,{
    method:"PATCH",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
    body:JSON.stringify({status})
  });
  const data = await res.json();
  alert(data.message||data.error);
  loadOrders();
  loadShipmentOrders();
}

async function loadShipmentOrders(){
  const res = await fetch("/api/orders",{ headers:{"Authorization":"Bearer "+token} });
  const orders = await res.json();
  renderShipmentOrders(orders);
}

function renderShipmentOrders(orders){
  const table = document.getElementById("shipmentTable");
  table.innerHTML="";
  orders.forEach(o=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${o.fullName||""}</td>
      <td>${o.phone1||""}</td>
      <td>${o.phone2||""}</td>
      <td>${o.address||""}</td>
      <td>${o.pieces||""}</td>
      <td>${o.size||""}</td>
      <td>${o.colors||""}</td>
      <td>${o.priceTotal||""}</td>
      <td class="status ${o.status}">${o.status}</td>
      <td>
        <button class="accept" onclick="updateShipmentStatus('${o.id}','ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±')">âœ”ï¸</button>
        <button class="reject" onclick="updateShipmentStatus('${o.id}','ØªÙ… Ø§Ù„ØºØ§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±')">âŒ</button>
      </td>
    `;
    table.appendChild(tr);
  });
}

async function updateShipmentStatus(id,status){
  const res = await fetch("/api/orders/"+id,{
    method:"PATCH",
    headers:{"Content-Type":"application/json","Authorization":"Bearer "+token},
    body:JSON.stringify({status})
  });
  const data = await res.json();
  alert(data.message||data.error);
  loadOrders();
  loadShipmentOrders();
}

checkAuth();
</script>
</body>
</html>