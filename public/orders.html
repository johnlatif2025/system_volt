<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</title>
<link rel="icon" href="https://i.postimg.cc/D0ywRzWK/Volt.jpg" type="image/png">
<style>
body { font-family: Tahoma, Arial; background:#f4f6f9; direction:rtl; margin:0; padding:0; }
.container { max-width:1000px; margin:40px auto; background:#fff; padding:30px; border-radius:16px; box-shadow:0 6px 20px rgba(0,0,0,0.1); }
h2 { text-align:center; margin-bottom:20px; color:#333; }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; margin-bottom:20px; }
input, textarea { width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; background:#fafafa; }
textarea { grid-column:span 2; min-height:80px; resize:none; }
button { grid-column:span 2; padding:14px; border:none; border-radius:8px; background:linear-gradient(90deg,#28a745,#218838); color:#fff; cursor:pointer; font-size:15px; }
button:hover { opacity:0.9; }
table { width:100%; border-collapse:collapse; margin-top:30px; table-layout: fixed; word-wrap: break-word; }
th, td { border:1px solid #ddd; padding:10px; text-align:center; vertical-align: middle; }
th { background:#f8f9fa; }
.status { font-weight:bold; }
.Ù…Ù‚Ø¨ÙˆÙ„ { color:green; }
.Ù…Ø±ÙÙˆØ¶ { color:red; }
.Ù‚ÙŠØ¯\\ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© { color:orange; }
.logout { float:left; background:#007bff; color:#fff; padding:8px 14px; border-radius:6px; margin-bottom:15px; cursor:pointer; }
.logout:hover { opacity:0.85; }
img { max-width:80px; border-radius:6px; cursor:pointer; }
.logo-img { max-width:120px; max-height:60px; display:block; margin:0 auto 20px auto; }
@media screen and (max-width:768px){
  table, thead, tbody, th, td, tr { display:block; }
  th { display:none; }
  td { border:none; position:relative; padding-left:50%; margin-bottom:10px; text-align:right; }
  td:before { position:absolute; left:10px; width:45%; white-space:nowrap; font-weight:bold; }
  td:nth-of-type(1):before { content:"Ø§Ù„Ø§Ø³Ù…"; }
  td:nth-of-type(2):before { content:"Ø§Ù„Ù‡Ø§ØªÙ1"; }
  td:nth-of-type(3):before { content:"Ø§Ù„Ù‡Ø§ØªÙ2"; }
  td:nth-of-type(4):before { content:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"; }
  td:nth-of-type(5):before { content:"Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹"; }
  td:nth-of-type(6):before { content:"Ø§Ù„Ù…Ù‚Ø§Ø³"; }
  td:nth-of-type(7):before { content:"Ø§Ù„Ø£Ù„ÙˆØ§Ù†"; }
  td:nth-of-type(8):before { content:"Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†"; }
  td:nth-of-type(9):before { content:"Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†"; }
  td:nth-of-type(10):before { content:"Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©"; }
  td:nth-of-type(11):before { content:"Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©"; }
  td:nth-of-type(12):before { content:"Ù…Ù„Ø­ÙˆØ¸Ø©"; }
  td:nth-of-type(13):before { content:"Ø§Ù„ØµÙˆØ±Ø©"; }
  td:nth-of-type(14):before { content:"Ø§Ù„Ø­Ø§Ù„Ø©"; }
}
</style>
</head>
<body>
<div class="container">
<img src="https://i.postimg.cc/D0ywRzWK/Volt.jpg" alt="Logo" class="logo-img">
<button class="logout" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<h2>Ø¥Ø¶Ø§ÙØ© Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
<div class="grid">
  <input type="text" id="fullName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
  <input type="text" id="phone1" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø£ÙˆÙ„">
  <input type="text" id="phone2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø«Ø§Ù†ÙŠ">
  <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„">
  <input type="number" id="pieces" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹">
  <input type="text" id="size" placeholder="Ø§Ù„Ù…Ù‚Ø§Ø³">
  <input type="text" id="colors" placeholder="Ø§Ù„Ø£Ù„ÙˆØ§Ù†">
  <input type="number" id="priceNoShip" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†">
  <input type="number" id="shipping" placeholder="Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†">
  <input type="number" id="priceTotal" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø´Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©">
  <input type="number" id="commission" placeholder="Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©">
  <textarea id="note" placeholder="Ù…Ù„Ø­ÙˆØ¸Ø© (Ù…ÙŠØ¹Ø§Ø¯/Ù…ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…)"></textarea>
  <input type="file" id="image" accept="image/*">
  <button onclick="addOrder()">ğŸ“¦ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<h2>ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ1</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ2</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹</th>
<th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
<th>Ø§Ù„Ø£Ù„ÙˆØ§Ù†</th>
<th>Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¯ÙˆÙ† Ø´Ø­Ù†</th>
<th>Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø´Ø­Ù†</th>
<th>Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
<th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©</th>
<th>Ù…Ù„Ø­ÙˆØ¸Ø©</th>
<th>Ø§Ù„ØµÙˆØ±Ø©</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
</tr>
</thead>
<tbody id="ordersTable"></tbody>
</table>
</div>

<script>
const token = localStorage.getItem("token"); 
const role = localStorage.getItem("role");

function logout(){ localStorage.clear(); window.location = "index.html"; }

async function checkAuth(){ if(!token || role!=="user"){ return window.location="index.html"; } await loadOrders(); }

async function addOrder(){
  if(!fullName.value.trim() || !phone1.value.trim() || !address.value.trim()){ alert("Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø£ÙˆÙ„ØŒ ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†"); return; }
  const formData = new FormData();
  ["fullName","phone1","phone2","address","pieces","size","colors","priceNoShip","shipping","priceTotal","commission","note"].forEach(f=>{
    if(document.getElementById(f).value) formData.append(f, document.getElementById(f).value);
  });
  if(image.files[0]) formData.append("image", image.files[0]);
  const res = await fetch("/api/orders",{ method:"POST", headers:{"Authorization":"Bearer "+token}, body: formData });
  const data = await res.json(); 
  alert(data.message || data.error);
  loadOrders();
}

async function loadOrders(){
  const res = await fetch("/api/orders",{ headers:{"Authorization":"Bearer "+token} });
  const orders = await res.json();
  renderOrders(orders);
}

function renderOrders(orders){
  const table = document.getElementById("ordersTable");
  table.innerHTML="";
  orders.forEach(o=>{
    const imgHTML=o.imageUrl?`<img src="${o.imageUrl}" onclick="window.open('${o.imageUrl}','_blank')">`:"Ù„Ø§ ÙŠÙˆØ¬Ø¯";
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${o.fullName||""}</td>
      <td>${o.phone1||""}</td>
      <td>${o.phone2||""}</td>
      <td>${o.address||""}</td>
      <td>${o.pieces||""}</td>
      <td>${o.size||""}</td>
      <td>${o.colors||""}</td>
      <td>${o.priceNoShip||""}</td>
      <td>${o.shipping||""}</td>
      <td>${o.priceTotal||""}</td>
      <td>${o.commission||""}</td>
      <td>${o.note||""}</td>
      <td>${imgHTML}</td>
      <td class="status ${o.status}">${o.status}</td>
    `;
    table.appendChild(tr);
  });
}

checkAuth();
</script>
</body>
</html>